#!/bin/bash

# 使用wch账号创建新闻
API_BASE_URL="http://localhost:8000/api"
USERNAME="wch"
PASSWORD="572515ha"

echo "🎵 音乐新闻创建工具"
echo "使用账号: $USERNAME"
echo "============================="

# 登录获取token
echo "🔐 登录中..."
LOGIN_RESPONSE=$(curl -s -X POST "${API_BASE_URL}/auth/login" \
  -H "Content-Type: application/json" \
  -d "{\"username\":\"${USERNAME}\",\"password\":\"${PASSWORD}\"}")

TOKEN=$(echo $LOGIN_RESPONSE | grep -o '"access_token":"[^"]*"' | cut -d'"' -f4)

if [ -z "$TOKEN" ]; then
    echo "❌ 登录失败: $LOGIN_RESPONSE"
    exit 1
fi

echo "✅ 登录成功"

# 精选音乐新闻数据
declare -a NEWS_DATA=(
    "🎵 2024年度最佳音乐专辑评选揭晓|经过数月的激烈角逐和专业评审，2024年度最佳音乐专辑评选活动终于落下帷幕。本次评选涵盖了流行、摇滚、电子、古典等多个音乐类型，共有来自全球的500多张专辑参与角逐。最终获奖作品展现了当代音乐的多元化发展趋势，融合了传统音乐元素与现代制作技术。|https://images.unsplash.com/photo-1493225457124-a3eb161ffa5f?w=500"
    "🎸 国际摇滚音乐节震撼开幕|一年一度的国际摇滚音乐节在海滨城市盛大开幕，来自20多个国家的顶级乐队齐聚一堂。本次音乐节不仅邀请了经典摇滚传奇乐队，还特别设置了新兴乐队展示平台，为年轻音乐人提供与大师同台演出的珍贵机会。预计将吸引超过10万名音乐爱好者。|https://images.unsplash.com/photo-1520523839897-bd0b52f945a0?w=500"
    "🎹 古典音乐遇见现代科技|著名交响乐团与科技公司联手，打造了一场融合虚拟现实技术的沉浸式古典音乐会。观众可以通过VR设备，仿佛置身于音乐厅的最佳位置，甚至可以走进乐团中间，近距离感受每一个乐器的演奏。这种创新表演形式为古典音乐注入了新活力。|https://images.unsplash.com/photo-1459749187778-3663c29ab4b3?w=500"
    "🎤 新生代歌手引领音乐潮流|年仅19岁的独立音乐人凭借其独特的音乐风格和深刻的歌词内容，在社交媒体上迅速走红。最新发布的单曲在各大音乐平台播放量突破千万次，被誉为Z世代的音乐代言人。融合了民谣、电子和说唱元素，预示着音乐产业的未来发展方向。|https://images.unsplash.com/photo-1483032469466-b937c425697b?w=500"
    "🥁 爵士音乐复兴浪潮来袭|近年来，爵士音乐在年轻一代中重新焕发生机。新一代爵士音乐人在保持传统爵士精神的同时，大胆融入嘻哈、电子等现代元素，创造出富有时代特色的新爵士风格。这种创新不仅吸引了更多年轻听众，也为传统爵士音乐带来了新的发展机遇。|https://images.unsplash.com/photo-1511671782779-c97d3d27a1d4?w=500"
    "🎧 音乐流媒体平台重大升级|主流音乐流媒体平台推出革命性的个性化推荐算法，能够根据用户的听歌习惯、情绪状态和时间场景，智能推荐最适合的音乐内容。新功能还包括社交分享、实时歌词翻译和高品质音频支持，为用户提供更加丰富的音乐体验。|https://images.unsplash.com/photo-1470225620780-dba8ba36b745?w=500"
    "🎪 音乐教育数字化变革|音乐教育正在经历一场数字化变革。在线音乐学习平台、AI辅助练习工具和虚拟现实音乐教室等新技术，让音乐学习变得更加便捷有趣。这些创新不仅降低了音乐教育的门槛，也为偏远地区的音乐爱好者提供了接受专业音乐教育的机会。|https://images.unsplash.com/photo-1506157786151-b8491531f063?w=500"
    "🌟 独立音乐人扶持计划启动|多家音乐公司联合推出全方位的独立音乐人扶持计划。该计划包括资金支持、制作指导、宣传推广和演出机会等多个环节，旨在帮助有才华的独立音乐人获得更好的发展机会。首批入选的50位音乐人将获得专业团队的一对一指导。|https://images.unsplash.com/photo-1510915361894-db8b60106cb1?w=500"
    "🎵 AI作曲技术引发创作革命|人工智能在音乐创作领域的应用正在引发一场创作革命。最新的AI作曲系统能够分析海量音乐数据，学习不同风格的创作特点，并协助音乐人创作出高质量的音乐作品。这项技术不仅提高了创作效率，还为音乐人提供了新的创作灵感来源。|https://images.unsplash.com/photo-1514320291840-2e0a9bf2a9ae?w=500"
    "🎼 世界音乐文化交流节开幕|第五届世界音乐文化交流节在国际音乐中心隆重开幕，来自六大洲的音乐家们将在为期一周的时间里，展示各自国家和地区的传统音乐文化。本届交流节特别设置了音乐工作坊、文化讲座和合作演出等环节，促进不同音乐文化之间的交流与融合。|https://images.unsplash.com/photo-1459749187778-3663c29ab4b3?w=500"
    "🎸 吉他制作工艺传承与创新|传统吉他制作工艺与现代技术的结合，正在为乐器制造业带来新的发展机遇。知名吉他制作师们在保持传统手工制作精髓的同时，运用现代材料科学和制作技术，打造出音质更加出色的吉他产品。这种传承与创新的结合提升了乐器品质。|https://images.unsplash.com/photo-1520523839897-bd0b52f945a0?w=500"
    "🎹 钢琴演奏技巧大师班开课|国际钢琴大师将在音乐学院开设为期三个月的钢琴演奏技巧大师班。课程涵盖古典、浪漫派和现代钢琴作品的演奏技巧，以及舞台表演和音乐表达等方面的专业指导。大师班采用小班制教学，为每位学员提供个性化指导。|https://images.unsplash.com/photo-1459749187778-3663c29ab4b3?w=500"
    "🎤 音乐版权保护新政策发布|为了更好地保护音乐创作者的权益，相关部门发布了全新的音乐版权保护政策。新政策加强了对数字音乐版权的保护力度，建立了更加完善的版权登记和维权机制。同时，政策还鼓励原创音乐创作，为音乐人提供了更多的法律保障和支持。|https://images.unsplash.com/photo-1483032469466-b937c425697b?w=500"
    "🥁 打击乐在现代音乐中的新角色|在现代音乐制作中，打击乐器正在发挥着越来越重要的作用。从传统的架子鼓到电子打击垫，从民族打击乐器到创新的声音设计，打击乐为现代音乐带来了丰富的节奏层次和声音色彩。许多音乐制作人开始重新审视打击乐的价值。|https://images.unsplash.com/photo-1511671782779-c97d3d27a1d4?w=500"
    "🎺 青少年管乐团培养计划|为了培养下一代管乐演奏人才，青少年管乐团培养计划正式启动。该计划面向8-18岁的青少年，提供专业的管乐器演奏培训和乐团演出机会。通过系统的音乐教育和实践演出，培养青少年的音乐素养和团队合作精神。|https://images.unsplash.com/photo-1470225620780-dba8ba36b745?w=500"
    "🎶 电子音乐制作软件大评测|深度评测当前主流的电子音乐制作软件，包括功能对比、易用性分析和价格评估。从入门级的免费软件到专业级的付费产品，为不同需求的音乐制作人提供选择建议。文章包含实际制作案例和专家建议，帮助读者找到最适合的制作工具。|https://images.unsplash.com/photo-1470225620780-dba8ba36b745?w=500"
    "🎵 民族音乐在流行音乐中的应用|探讨民族音乐元素在现代流行音乐中的创新应用，分析成功案例和发展趋势。从古典民族乐器的现代化改造到传统音律在电子音乐中的运用，展现了民族音乐在当代音乐产业中的重要价值和发展潜力。|https://images.unsplash.com/photo-1506157786151-b8491531f063?w=500"
    "🔊 音响设备选购完全指南|全面介绍家庭和专业音响设备的选购要点，包括扬声器、功放器、音源设备的技术参数和品牌推荐。结合不同使用场景和预算范围，提供个性化的配置方案，帮助音乐爱好者打造理想的音响系统。|https://images.unsplash.com/photo-1510915361894-db8b60106cb1?w=500"
    "🎙️ 知名制作人独家访谈|独家专访知名音乐制作人，深入了解其创作理念、制作技巧和行业见解。分享多年来的制作经验和对音乐产业发展的思考，为年轻制作人提供宝贵的职业建议和创作灵感。访谈内容涵盖从传统录音到数字制作的演变历程。|https://images.unsplash.com/photo-1483032469466-b937c425697b?w=500"
    "🎵 音乐治疗医疗领域新突破|介绍音乐治疗在医疗康复、心理治疗和特殊教育领域的最新应用成果。通过科学研究数据和实际案例，展现音乐对人类身心健康的积极影响，探讨音乐治疗的发展前景和应用潜力。为音乐与医学的结合开辟了新的道路。|https://images.unsplash.com/photo-1459749187778-3663c29ab4b3?w=500"
)

SUCCESS_COUNT=0
TOTAL_COUNT=${#NEWS_DATA[@]}

echo "🚀 开始创建 $TOTAL_COUNT 条音乐新闻..."
echo ""

for i in "${!NEWS_DATA[@]}"; do
    IFS='|' read -r TITLE DESCRIPTION IMAGE_URL <<< "${NEWS_DATA[$i]}"
    
    echo "📝 创建第 $((i+1)) 条: ${TITLE:0:40}..."
    
    # 转义JSON特殊字符
    TITLE_ESC=$(echo "$TITLE" | sed 's/"/\\"/g')
    DESCRIPTION_ESC=$(echo "$DESCRIPTION" | sed 's/"/\\"/g')
    
    RESPONSE=$(curl -s -X POST "${API_BASE_URL}/news/" \
        -H "Authorization: Bearer ${TOKEN}" \
        -H "Content-Type: application/json" \
        -d "{\"title\":\"${TITLE_ESC}\",\"description\":\"${DESCRIPTION_ESC}\",\"image_url\":\"${IMAGE_URL}\"}")
    
    if echo "$RESPONSE" | grep -q '"id"'; then
        echo "✅ 创建成功"
        SUCCESS_COUNT=$((SUCCESS_COUNT + 1))
    else
        echo "❌ 创建失败: $(echo $RESPONSE | head -100)"
    fi
    
    sleep 0.3
done

echo ""
echo "🎉 批量创建完成！"
echo "✅ 成功创建: $SUCCESS_COUNT/$TOTAL_COUNT 条新闻"
echo "📱 现在可以刷新前端页面查看新闻了！"